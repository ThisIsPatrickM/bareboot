.check:
  tags:
    - dosis
  stage: check
  variables:
    CHECK: clang-tidy
    CROSS: ""
    DEVICE: default
  script: |
    echo "Executing check named ${CHECK} for device ${DEVICE}"
    rm -rf build-${DEVICE} && meson build-${DEVICE} ${CROSS}
    if ninja -C build-${DEVICE} ${CHECK}  | grep -e 'error:\|warning:'; then
      exit 1
    fi

clang-tidy:
  extends: .check
  variables:
    CHECK: tidy

clang-tidy-va41620:
  extends: .check
  variables:
    CHECK: tidy
    DEVICE: va41620
    CROSS: "--cross-file include/va41620/cross_files/cross.ini"

clang-format:
  extends: .check   
  variables: 
    CHECK: clang-format
